---
# - name: Block remote MySQL access (3306) — security hardening
#   ansible.posix.firewalld:
#     port: 5000/tcp
#     state: enabled
#     permanent: true

- name: Install Flask and MySQL connector
  ansible.builtin.pip:
    name:
    - flask
    - flask-mysql
    state: present

# - name: Deploy web application repo
#   ansible.builtin.git:
#     repo: "https://github.com/mmumshad/simple-webapp.git"
#     dest: /var/www/simple-webapp
#     version: master
  # COMMENT:
  #   Deploy under /var/www — system paths, not home folders.

- name: Create non-root user for running the Flask app
  ansible.builtin.user:
    name: webapp
    system: yes
    shell: /sbin/nologin
  # COMMENT:
  #   NEVER run Flask app as root.

- name: Fix application permissions
  ansible.builtin.file:
    path: /var/www/simple-webapp
    owner: webapp
    group: webapp
    recurse: yes
  # COMMENT:
  #   Principle of least privilege — app owns only what it needs.

- name: Starting the web server
  ansible.builtin.shell:
    python -m flask --app /var/www/simple-webapp/app.py run --host=0.0.0.0 &
